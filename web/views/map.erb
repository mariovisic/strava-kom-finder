<div id="map" style="width: 100%; height: 100%;"></div>

<script>
function initMap() {
  map = new google.maps.Map(document.getElementById('map'), {
    zoom: 14
  })

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      var pos = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      }

      map.setCenter(pos)

      boundsString = map.getBounds().toString().replace(/[\(\)]/g, '')

        fetch("/segments?bounds=" + boundsString, { credentials: 'include' }).then(function(response) {
          return response.json()
        }).then(function(data) {

          data.segments.forEach(function(segment) {
            path = google.maps.geometry.encoding.decodePath(segment.points)

              var segmentLine = new google.maps.Polyline({
                path: path,
                map: map
              })
          })

          console.log(data)
          window.z = data
        })
    })
  }
}

</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=<%=ENV['GOOGLE_MAPS_API_KEY'] %>&callback=initMap&libraries=geometry"> </script>
